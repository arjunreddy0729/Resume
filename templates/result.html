<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resume Analysis Result</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: linear-gradient(120deg, #003c3c, #3aa885);
      color: #ffffff;
      font-family: "Poppins", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .card {
      background-color: rgba(0, 0, 0, 0.25);
      border: none;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
      padding: 2rem;
      width: 90%;
      max-width: 800px;
    }

    .skill-chip {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 6px 15px;
      margin: 4px;
      display: inline-block;
      font-size: 0.9rem;
    }

    h2, h3, h5 {
      font-weight: 600;
    }

    a {
      text-decoration: none;
    }

    canvas {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 10px;
    }
  </style>
</head>

<body>
  <div class="card text-center">
    <h2 class="fw-bold mb-3">Predicted Job Category</h2>
    <h3 class="text-info mb-3">{{ prediction }}</h3>

    {% if confidence %}
      <p><strong>Model Confidence:</strong> {{ confidence }}%</p>
      <div class="progress mb-3" style="height: 20px;">
        <div
          id="confidenceBar"
          class="progress-bar bg-success"
          role="progressbar"
          aria-valuenow="{{ confidence }}"
          aria-valuemin="0"
          aria-valuemax="100"
        ></div>
      </div>
    {% endif %}

    {% if match_score %}
      <h5 class="mt-3">Job Match Score: <span class="text-success">{{ match_score }}%</span></h5>
      <div class="progress mb-3" style="height: 20px;">
        <div
          id="matchBar"
          class="progress-bar bg-info"
          role="progressbar"
          aria-valuenow="{{ match_score }}"
          aria-valuemin="0"
          aria-valuemax="100"
        ></div>
      </div>
    {% endif %}

    {% if skills %}
      <h5 class="mt-4">Top Skills Detected:</h5>
      {% for s in skills %}
        <span class="skill-chip">{{ s }}</span>
      {% endfor %}
    {% endif %}

    <canvas id="skillChart" height="150" class="mt-4"></canvas>

    <a href="/" class="btn btn-outline-light mt-4">← Upload Another Resume</a>

    <form action="/download_report" method="POST">
      <input type="hidden" name="prediction" value="{{ prediction }}">
      <input type="hidden" name="confidence" value="{{ confidence }}">
      <input type="hidden" name="skills" value="{{ skills|join(', ') }}">
      <input type="hidden" name="match_score" value="{{ match_score }}">
      <button type="submit" class="btn btn-success mt-3">⬇️ Download Report</button>
    </form>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const confidenceVal = Number("{{ confidence|default(0) }}");
      const matchVal = Number("{{ match_score|default(0) }}");

      const confBar = document.getElementById("confidenceBar");
      if (confBar) confBar.style.width = confidenceVal + "%";

      const matchBar = document.getElementById("matchBar");
      if (matchBar) matchBar.style.width = matchVal + "%";

      const ctx = document.getElementById("skillChart");
      if (!ctx) return;

      new Chart(ctx, {
        type: "radar",
        data: {
          labels: ["Technical", "Analytical", "Leadership", "Communication", "Management"],
          datasets: [{
            label: "Resume Strength",
            data: [confidenceVal / 20, matchVal / 10, 8, 7, 6],
            fill: true,
            backgroundColor: "rgba(75,192,192,0.2)",
            borderColor: "rgb(75,192,192)",
            pointBackgroundColor: "rgb(75,192,192)"
          }]
        },
        options: {
          scales: {
            r: {
              beginAtZero: true,
              max: 10,
              grid: { color: "rgba(255,255,255,0.2)" },
              angleLines: { color: "rgba(255,255,255,0.2)" },
              pointLabels: { color: "#fff" }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    });
  </script>
</body>
</html>
